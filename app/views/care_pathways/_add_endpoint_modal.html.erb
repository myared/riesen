<!-- Add Clinical Endpoint Modal -->
<div id="addEndpointModal" class="modal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add Clinical Goal</h3>
      <button class="modal-close" onclick="closeAddEndpointModal()">&times;</button>
    </div>
    
    <%= form_with url: add_clinical_endpoint_patient_care_pathway_path(@patient, @care_pathway),
                  method: :post,
                  data: { turbo: true },
                  id: "add-endpoint-form" do |f| %>
      <div class="modal-body">
        <input type="hidden" name="active_tab" value="endpoints">
        <div class="form-group">
          <label for="endpoint_name">Goal Name</label>
          <select name="endpoint[name]" id="endpoint_name" class="form-control" required>
            <option value="">Select goal...</option>
            <% CarePathwayClinicalEndpoint::CLINICAL_ENDPOINTS.each do |endpoint| %>
              <option value="<%= endpoint %>"><%= endpoint %></option>
            <% end %>
          </select>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeAddEndpointModal()">Cancel</button>
        <button type="submit" class="btn btn-primary">Add Goal</button>
      </div>
    <% end %>
  </div>
</div>

<script>
  function showAddEndpointModal(patientId, pathwayId) {
    document.getElementById('addEndpointModal').style.display = 'flex';
  }

  function closeAddEndpointModal() {
    document.getElementById('addEndpointModal').style.display = 'none';
    // Reset form
    document.getElementById('add-endpoint-form').reset();
  }

  // Handle form submission with Turbo
  document.addEventListener('turbo:submit-end', (event) => {
    if (event.target.id === 'add-endpoint-form') {
      if (event.detail.success) {
        closeAddEndpointModal();
        // Form was successful, page will be updated by redirect
      }
    }
  });
</script>
