<div class="floor-view">
  <h2>All Department Patients</h2>
  <div class="real-time-metrics">
    <h3>Real-time Metrics</h3>
    <div class="metrics-grid">
      <div class="metric">
        <label>Current ED Census</label>
        <div class="value"><%= @current_ed_census %></div>
      </div>
      <div class="metric">
        <label>RP Utilization</label>
        <div class="value"><%= @rp_utilization %>/12</div>
      </div>
      <div class="metric">
        <label>Avg Door-to-Provider</label>
        <div class="value"><%= @avg_door_to_provider %>m</div>
      </div>
      <div class="metric">
        <label>Avg ED LOS</label>
        <div class="value"><%= @avg_ed_los %>m</div>
      </div>
      <div class="metric">
        <label>Longest Wait</label>
        <div class="value danger"><%= @longest_wait %>m</div>
      </div>
      <div class="metric">
        <label>LWBS Rate</label>
        <div class="value"><%= @lwbs_rate %>%</div>
      </div>
    </div>
  </div>

  <div class="floor-layout">
    <div class="triage-section">
      <h3>Waiting Room</h3>
      <div class="triage-grid">
        <% # Show patients in waiting room or triage %>
        <% @triage_patients = Patient.in_triage.includes(:care_pathways, :vitals) %>
        <% if @triage_patients.any? %>
          <% @triage_patients.each do |patient| %>
            <%
              # Determine status class based on patient wait_status
              patient_class = case patient.wait_status
                            when :green
                              'occupied-green'
                            when :yellow
                              'occupied-yellow'
                            when :red
                              'occupied-red'
                            else
                              'occupied'
                            end
            %>
            <div class="room-card <%= patient_class %>">
              <div class="room-number"><%= patient.display_location %></div>
              <div class="patient-name"><%= patient.full_name %></div>
              <div class="room-timer"><%= patient.wait_time_minutes %>m</div>
            </div>
          <% end %>
        <% else %>
          <% # Show empty triage bays if no patients %>
          <% (1..6).each do |i| %>
            <div class="room-card available">
              <div class="room-number">Triage <%= i %></div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="ed-rooms-section">
      <h3>ED Rooms</h3>
      <div class="room-grid">
        <% @ed_rooms.each do |room| %>
          <%
            # Determine room status class based on patient wait_status
            room_class = if room.status_available?
                          'available'
                        elsif room.current_patient
                          case room.current_patient.wait_status
                          when :green
                            'occupied-green'
                          when :yellow
                            'occupied-yellow'
                          when :red
                            'occupied-red'
                          else
                            'occupied'
                          end
                        else
                          'occupied'
                        end
          %>
          <div class="room-card <%= room_class %>">
            <div class="room-number"><%= room.number %></div>
            <% if room.current_patient %>
              <div class="patient-name"><%= room.current_patient.full_name %></div>
              <div class="room-timer"><%= room.current_patient.wait_time_minutes %>m</div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="rp-area-section">
      <h3>RP Area</h3>
      <div class="rp-grid">
        <% @rp_rooms.each do |room| %>
          <%
            # Determine room status class based on patient wait_status
            room_class = if room.status_available?
                          'rp-room available'
                        elsif room.current_patient
                          case room.current_patient.wait_status
                          when :green
                            'rp-room occupied-green'
                          when :yellow
                            'rp-room occupied-yellow'
                          when :red
                            'rp-room occupied-red'
                          else
                            'rp-room occupied'
                          end
                        else
                          'rp-room occupied'
                        end
          %>
          <div class="room-card <%= room_class %>">
            <div class="room-number"><%= room.number %></div>
            <% if room.current_patient %>
              <div class="patient-name"><%= room.current_patient.full_name %></div>
              <div class="time-in-room"><%= room.current_patient.wait_time_minutes %>m</div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>