<div class="dashboard-sidebar">
  <div class="sidebar-stats">
    <div class="stat-card">
      <div class="stat-label">RP Utilization</div>
      <div class="stat-value"><%= @rp_utilization %>%</div>
    </div>

    <div class="stat-card">
      <div class="stat-label">Results Pending</div>
      <div class="stat-value"><%= @patients.count %></div>
    </div>

    <div class="stat-card">
      <div class="stat-label">Avg Time to RP</div>
      <div class="stat-value"><%= @avg_wait_time.round %>m</div>
    </div>
  </div>
</div>

<div class="dashboard-main">
  <h2>Results Pending Patients</h2>

  <% if @patients.empty? %>
    <div class="empty-state">
      <p>No patients currently in Results Pending</p>
    </div>
  <% else %>
    <div class="patient-table">
      <table>
        <thead>
          <tr>
            <th>Room</th>
            <th class="patient-header">Patient</th>
            <th>Care Pathway</th>
            <th>Pending Task List</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @patients.each do |patient| %>
            <% is_waiting = patient.location_waiting_room? || (patient.location_pending_transfer? && patient.rp_eligible?) %>
            <tr data-patient-id="<%= patient.id %>" class="<%= 'waiting-room-patient' if is_waiting %>">
              <td><%= patient.display_room %></td>
              <td class="patient-cell">
                <%= link_to patient_path(patient), data: { turbo_frame: "patient_modal" } do %>
                  <div><strong><%= patient.full_name %></strong></div>
                  <div style="font-size: 12px; color: #586069;"><%= patient.age %>Y, <%= patient.chief_complaint %></div>
                <% end %>
              </td>
              <td>
                <div class="care-pathway-cell">
                  <% if patient.location_waiting_room? || (patient.location_pending_transfer? && patient.rp_eligible?) %>
                    <span class="care-pathway-label">WR</span>
                  <% else %>
                    <% progress = patient.active_care_pathway&.progress_percentage || 0 %>
                    <%= link_to patient_care_pathways_path(patient, referrer: 'rp'),
                                class: "progress-ring-button",
                                style: "--progress: #{progress}" do %>
                      <span class="progress-text"><%= progress %>%</span>
                    <% end %>
                  <% end %>
                </div>
              </td>
              <td>
                <%= render 'shared/simplified_task_list', patient: patient, referrer: 'rp' %>
              </td>
              <td>
                <div class="action-buttons">
                  <%= patient_action_button(patient, 'rp') %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>

<turbo-frame id="patient_modal"></turbo-frame>
